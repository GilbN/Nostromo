upstream grafana {
    # the grafana server
    server 192.168.1.34:3000;
    keepalive 64;
}

server {
	listen 80;
	server_name grafana.domain.com;
	return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
	include /config/nginx/php.conf;
	include /config/nginx/proxy.conf;
# the virtual host name of this
    server_name grafana.domain.com;
	
#SSL settings
	include /config/nginx/strong-ssl.conf;
	
#Organizr auth
	include /config/nginx/serverauth.conf; #For server-auth with Organizr, remove unless you use Organizr.
	
#Maxmind geoblock
	include /config/nginx/geoblock.conf;

    location / {
        proxy_pass http://grafana;
	proxy_hide_header X-Frame-Options;
	proxy_set_header X-Forwarded-Host $host;
        proxy_set_header X-Forwarded-Server $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_http_version 1.1;
        proxy_pass_request_headers on;
        proxy_set_header Connection "keep-alive";
        proxy_store off;
	auth_request /auth-user; #For server-auth with Organizr, remove unless you use Organizr.
    }
}
